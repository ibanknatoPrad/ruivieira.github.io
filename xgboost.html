<!doctype html><html lang=en-uk>
<head>
<script data-goatcounter=https://ruivieira-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script type=module src=/js/deeplinks/deeplinks.js></script>
<link rel=preload href=/lib/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=stylesheet href=/css/kbd.css type=text/css>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> XGBoost Â· Rui Vieira</title>
<link rel=canonical href=https://ruivieira.dev/xgboost.html>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="XGBoost">
<meta property="og:description" content="Introduction XGBoost1 is a popular regularizing gradient boosting framework.
Installation In most systems, installing XGBoost can be done simply by using pip
$ pip install xgboost Example Training XGBoost with the credit-bias dataset.
import pandas as pd data = pd.read_csv(&#34;data/credit-bias-train.zip&#34;) data.head() NewCreditCustomer Amount Interest LoanDuration Education \ 0 False 2125.0 20.97 60 4.0 1 False 3000.0 17.12 60 5.0 2 True 9100.0 13.67 60 4.0 3 True 635.0 42.66 60 2.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ruivieira.dev/xgboost.html"><meta property="article:section" content="posts">
<meta property="article:modified_time" content="2022-03-13T15:32:02+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="XGBoost">
<meta name=twitter:description content="Introduction XGBoost1 is a popular regularizing gradient boosting framework.
Installation In most systems, installing XGBoost can be done simply by using pip
$ pip install xgboost Example Training XGBoost with the credit-bias dataset.
import pandas as pd data = pd.read_csv(&#34;data/credit-bias-train.zip&#34;) data.head() NewCreditCustomer Amount Interest LoanDuration Education \ 0 False 2125.0 20.97 60 4.0 1 False 3000.0 17.12 60 5.0 2 True 9100.0 13.67 60 4.0 3 True 635.0 42.66 60 2.">
<link rel=stylesheet href=https://ruivieira.dev/css/styles.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://ruivieira.dev/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/map/>All pages</a></li>
<li><a href=/search.html>Search</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://ruivieira.dev/workflow.html aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fruivieira.dev%2fxgboost.html" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&text=XGBoost" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&title=XGBoost" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&is_video=false&description=XGBoost" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=XGBoost&body=Check out this article: https%3a%2f%2fruivieira.dev%2fxgboost.html" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&title=XGBoost" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&title=XGBoost" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&name=XGBoost&description=Introduction%20XGBoost1%20is%20a%20popular%20regularizing%20gradient%20boosting%20framework.%0aInstallation%20In%20most%20systems%2c%20installing%20XGBoost%20can%20be%20done%20simply%20by%20using%20pip%0a%24%20pip%20install%20xgboost%20Example%20Training%20XGBoost%20with%20the%20credit-bias%20dataset.%0aimport%20pandas%20as%20pd%20data%20%3d%20pd.read_csv%28%26%2334%3bdata%2fcredit-bias-train.zip%26%2334%3b%29%20data.head%28%29%20NewCreditCustomer%20Amount%20Interest%20LoanDuration%20Education%20%5c%200%20False%202125.0%2020.97%2060%204.0%201%20False%203000.0%2017.12%2060%205.0%202%20True%209100.0%2013.67%2060%204.0%203%20True%20635.0%2042.66%2060%202." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fruivieira.dev%2fxgboost.html&t=XGBoost" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<h4>Contents</h4>
<nav id=TableOfContents>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#installation>Installation</a></li>
<li><a href=#example>Example</a>
<ul>
<li><a href=#hyperparameter-estimation>Hyperparameter estimation</a></li>
</ul>
</li>
<li><a href=#visualisation>Visualisation</a></li>
<li><a href=#roc-and-auc>ROC and AUC</a></li>
</ul>
</nav>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
XGBoost
</h1>
<div class=meta>
<div class=postdate>
Updated <time datetime="2022-03-13 15:32:02 +0000 GMT" itemprop=datePublished>2022-03-13</time>
<span class=commit-hash>(9ccda74)</span>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<h2 id=introduction>Introduction</h2>
<p><code>XGBoost</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> is a popular regularizing gradient boosting framework.</p>
<h2 id=installation>Installation</h2>
<p>In most systems, installing <code>XGBoost</code> can be done simply by using <code>pip</code></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ pip install xgboost
</code></pre></div><h2 id=example>Example</h2>
<p>Training XGBoost with the credit-bias dataset.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>import</span> <span style=color:#555>pandas</span> <span style=font-weight:700>as</span> <span style=color:#555>pd</span>

data <span style=font-weight:700>=</span> pd<span style=font-weight:700>.</span>read_csv(<span style=color:#b84>&#34;data/credit-bias-train.zip&#34;</span>)
data<span style=font-weight:700>.</span>head()
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>   NewCreditCustomer  Amount  Interest  LoanDuration  Education  \
0              False  2125.0     20.97            60        4.0
1              False  3000.0     17.12            60        5.0
2               True  9100.0     13.67            60        4.0
3               True   635.0     42.66            60        2.0
4              False  5000.0     24.52            60        4.0

   NrOfDependants  EmploymentDurationCurrentEmployer  \
0             0.0                                6.0
1             0.0                                6.0
2             1.0                                3.0
3             0.0                                1.0
4             1.0                                5.0

   IncomeFromPrincipalEmployer  IncomeFromPension  IncomeFromFamilyAllowance  \
0                          0.0              301.0                        0.0
1                        900.0                0.0                        0.0
2                        600.0                0.0                        0.0
3                        745.0                0.0                        0.0
4                       1000.0                0.0                        0.0

   ...  Mortgage  Other  Owner  Owner_with_encumbrance  Tenant  Entrepreneur  \
0  ...         0      0      1                       0       0             0
1  ...         0      0      1                       0       0             1
2  ...         1      0      0                       0       0             1
3  ...         0      0      0                       0       1             0
4  ...         0      0      0                       0       0             0

   Fully  Partially  Retiree  Self_employed
0      0          0        1              0
1      0          0        0              0
2      0          0        0              0
3      1          0        0              0
4      1          0        0              0

[5 rows x 40 columns]
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>X_df <span style=font-weight:700>=</span> data<span style=font-weight:700>.</span>drop(<span style=color:#b84>&#39;PaidLoan&#39;</span>, axis<span style=font-weight:700>=</span><span style=color:#099>1</span>)
y_df <span style=font-weight:700>=</span> data[<span style=color:#b84>&#39;PaidLoan&#39;</span>]
y_df<span style=font-weight:700>.</span>describe()
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>count     58003
unique        2
top        True
freq      29219
Name: PaidLoan, dtype: object
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>from</span> <span style=color:#555>sklearn.model_selection</span> <span style=font-weight:700>import</span> train_test_split
train_x, test_x, train_y, test_y <span style=font-weight:700>=</span> train_test_split(X_df, y_df, test_size<span style=font-weight:700>=</span><span style=color:#099>0.25</span>, random_state<span style=font-weight:700>=</span><span style=color:#099>42</span>)
</code></pre></div><h3 id=hyperparameter-estimation>Hyperparameter estimation</h3>
<p>Runs a grid search to find the tuning parameters that maxisimise the area under the curve (AUC). <code>train_x</code> is the <span class=focus data-keyword=train_x>training data</span> frame with loan details and <code>train_y</code> is the default target column for training.
The method returns the best parameters and corresponding AUC score.</p>
<p>The <code>objective</code> parameter<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> specifies the learning task and the corresponding learning objective. Possible values include:</p>
<h4 id=objective-function>Objective function</h4>
<ul>
<li><code>reg:squarederror</code>, regression with squared loss.</li>
<li><code>reg:squaredlogerror</code>, regression with squared log loss</li>
<li><code>reg:logistic</code>, logistic regression</li>
<li><code>reg:pseudohubererror</code>, regression with Pseudo Huber loss, a twice differentiable alternative to absolute loss.</li>
<li><code>binary:logistic</code>, logistic regression for binary classification, output probability</li>
<li><code>binary:logitraw</code>, logistic regression for binary classification, output score before logistic transformation</li>
<li><code>binary:hinge</code>, hinge loss for binary classification. This makes predictions of 0 or 1, rather than producing probabilities.</li>
<li><code>count:poisson</code>, poisson regression for count data, output mean of Poisson distribution</li>
<li><code>survival:cox</code>, Cox regression for right censored survival time data (negative values are considered right censored).</li>
<li><code>survival:aft</code>, Accelerated failure time model for censored survival time data. See Survival Analysis with Accelerated Failure Time for details.</li>
<li><code>aft_loss_distribution</code>, Probability Density Function used by survival:aft objective and aft-nloglik metric.</li>
<li><code>multi:softmax</code>, set XGBoost to do multiclass classification using the softmax objective, you also need to set <code>num_class</code> (number of classes)</li>
<li><code>multi:softprob</code>, same as softmax, but output a vector of <code>ndata * nclas~s, which can be further reshaped to ~ndata * nclass</code> matrix. The result contains predicted probability of each data point belonging to each class.</li>
<li><code>rank:pairwise</code>, Use LambdaMART to perform pairwise ranking where the pairwise loss is minimized</li>
<li><code>rank:ndcg</code>, Use LambdaMART to perform list-wise ranking where Normalized Discounted Cumulative Gain (NDCG) is maximized</li>
<li><code>rank:map</code>, Use LambdaMART to perform list-wise ranking where Mean Average Precision (MAP) is maximized</li>
<li><code>reg:gamma</code>, gamma regression with log-link. Output is a mean of gamma distribution. It might be useful, e.g., for modeling insurance claims severity, or for any outcome that might be gamma-distributed.</li>
<li><code>reg:tweedie</code>, Tweedie regression with log-link. It might be useful, <em>e.g.</em>, for modeling total loss in insurance, or for any outcome that might be Tweedie-distributed.</li>
</ul>
<h4 id=weight-balance>Weight balance</h4>
<p><code>scale_pos_weight~</code> (default <code>1</code>) control the balance of <em>positive</em> and <em>negative</em> weights, useful for unbalanced classes.
A typical value to consider is <code>sum(negative instances) / sum(positive instances)</code>.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>from</span> <span style=color:#555>sklearn.model_selection</span> <span style=font-weight:700>import</span> GridSearchCV
<span style=font-weight:700>from</span> <span style=color:#555>xgboost.sklearn</span> <span style=font-weight:700>import</span> XGBClassifier
<span style=font-weight:700>from</span> <span style=color:#555>typing</span> <span style=font-weight:700>import</span> Tuple

<span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>find_best_xgboost_model</span>(train_x: pd<span style=font-weight:700>.</span>DataFrame, train_y: pd<span style=font-weight:700>.</span>Series) <span style=font-weight:700>-&gt;</span> Tuple[<span style=color:#999>dict</span>, <span style=color:#999>float</span>]:
    scale_pos_weight <span style=font-weight:700>=</span> (<span style=color:#999>len</span>(train_y) <span style=font-weight:700>-</span> train_y<span style=font-weight:700>.</span>sum()) <span style=font-weight:700>/</span> train_y<span style=font-weight:700>.</span>sum()

    param_test <span style=font-weight:700>=</span> {
            <span style=color:#b84>&#39;max_depth&#39;</span>: [<span style=color:#099>1</span>, <span style=color:#099>2</span>, <span style=color:#099>4</span>, <span style=color:#099>8</span>],
            <span style=color:#b84>&#39;learning_rate&#39;</span>: [<span style=color:#099>0.05</span>, <span style=color:#099>0.06</span>, <span style=color:#099>0.07</span>],
            <span style=color:#b84>&#39;n_estimators&#39;</span>: [<span style=color:#099>10</span>, <span style=color:#099>100</span>, <span style=color:#099>200</span>]
        }

    gsearch <span style=font-weight:700>=</span> GridSearchCV(estimator<span style=font-weight:700>=</span>XGBClassifier(
        use_label_encoder<span style=font-weight:700>=</span><span style=font-weight:700>False</span>,
        objective<span style=font-weight:700>=</span><span style=color:#b84>&#39;binary:logistic&#39;</span>,
        scale_pos_weight<span style=font-weight:700>=</span>scale_pos_weight,
        seed<span style=font-weight:700>=</span><span style=color:#099>27</span>),
        param_grid<span style=font-weight:700>=</span>param_test, scoring<span style=font-weight:700>=</span><span style=color:#b84>&#39;roc_auc&#39;</span>, n_jobs<span style=font-weight:700>=-</span><span style=color:#099>1</span>, cv<span style=font-weight:700>=</span><span style=color:#099>8</span>)

    gsearch<span style=font-weight:700>.</span>fit(train_x, train_y)

    <span style=font-weight:700>return</span> gsearch<span style=font-weight:700>.</span>best_params_, gsearch<span style=font-weight:700>.</span>best_score_
best_params, best_score <span style=font-weight:700>=</span> find_best_xgboost_model(train_x, train_y)
</code></pre></div><p>Using the xgboost model parameters, it predicts the probabilities of defaulting.</p>
<ul>
<li><code>best_params_</code>, best tuning parameters</li>
<li><code>train_x</code>, training dataframe with loan details</li>
<li><code>train_y</code>, default target column for training</li>
<li><code>test_x</code>, testing dataframe with loan details</li>
<li><code>test_y</code>, default target column for testing</li>
</ul>
<p>The result is a series of probabilities whether loan entry will default or not and corresponding model&rsquo;s AUC score</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>from</span> <span style=color:#555>sklearn.metrics</span> <span style=font-weight:700>import</span> roc_auc_score

<span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>xgboost_predict</span>(best_params_: <span style=color:#999>dict</span>, train_x: pd<span style=font-weight:700>.</span>DataFrame, train_y: pd<span style=font-weight:700>.</span>Series, test_x: pd<span style=font-weight:700>.</span>DataFrame,
                    test_y: pd<span style=font-weight:700>.</span>Series) <span style=font-weight:700>-&gt;</span> Tuple[<span style=color:#999>list</span>, <span style=color:#999>float</span>]:
    scale_pos_weight <span style=font-weight:700>=</span> (<span style=color:#999>len</span>(train_y) <span style=font-weight:700>-</span> train_y<span style=font-weight:700>.</span>sum()) <span style=font-weight:700>/</span> train_y<span style=font-weight:700>.</span>sum()
    xgb_model <span style=font-weight:700>=</span> XGBClassifier(objective<span style=font-weight:700>=</span><span style=color:#b84>&#39;binary:logistic&#39;</span>,
                              scale_pos_weight<span style=font-weight:700>=</span>scale_pos_weight,
                              seed<span style=font-weight:700>=</span><span style=color:#099>27</span>,
                              max_depth<span style=font-weight:700>=</span>best_params_[<span style=color:#b84>&#39;max_depth&#39;</span>],
                              learning_rate<span style=font-weight:700>=</span>best_params_[<span style=color:#b84>&#39;learning_rate&#39;</span>],
                              n_estimators<span style=font-weight:700>=</span>best_params_[<span style=color:#b84>&#39;n_estimators&#39;</span>]
                              )

    xgb_model<span style=font-weight:700>.</span>fit(train_x, train_y)
    predicted_probabilities_ <span style=font-weight:700>=</span> xgb_model<span style=font-weight:700>.</span>predict_proba(test_x)[:, <span style=color:#099>1</span>]
    auc_ <span style=font-weight:700>=</span> roc_auc_score(test_y, predicted_probabilities_)

    <span style=font-weight:700>return</span> predicted_probabilities_, auc_
predicted_probabilities, auc <span style=font-weight:700>=</span> xgboost_predict(best_params, train_x, train_y, test_x, test_y)
<span style=color:#999>print</span>(<span style=color:#b84>&#34;AUC: </span><span style=color:#b84>{}</span><span style=color:#b84>&#34;</span><span style=font-weight:700>.</span>format(auc))
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>/Users/rui/.virtualenvs/blog-source/lib/python3.9/site-packages/xgboost/sklearn.py:1224: UserWarning: The use of label encoder in XGBClassifier is deprecated and will be removed in a future release. To remove this warning, do the following: 1) Pass option use_label_encoder=False when constructing XGBClassifier object; and 2) Encode your labels (y) as integers starting with 0, i.e. 0, 1, 2, ..., [num_class - 1].
[19:39:18] WARNING: /Users/runner/work/xgboost/xgboost/src/learner.cc:1115: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.
AUC: 0.7372207434311429
</code></pre></div><p>Filters the original loan dataframe to just include the loans from the test dataframe and then it adds the predicted probabilities.</p>
<ul>
<li><code>loans_df_</code>, original loan dataframe</li>
<li><code>test_index</code>, indices from the test dataframes</li>
<li><code>predicted_probabilities_</code>, the probabilities forecasted by the XGBoost model</li>
</ul>
<p>Returns the loans dataframe with predictions</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>import</span> <span style=color:#555>numpy</span> <span style=font-weight:700>as</span> <span style=color:#555>np</span>

<span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>prepare_test_with_predictions</span>(loans_df_: pd<span style=font-weight:700>.</span>DataFrame, test_index: pd<span style=font-weight:700>.</span>Index, predicted_probabilities_: np<span style=font-weight:700>.</span>array)\
        <span style=font-weight:700>-&gt;</span>pd<span style=font-weight:700>.</span>DataFrame:
    loan_test_df <span style=font-weight:700>=</span> loans_df_<span style=font-weight:700>.</span>loc[test_index]
    loan_test_df[<span style=color:#b84>&#39;predicted_probabilities&#39;</span>] <span style=font-weight:700>=</span> predicted_probabilities_
    <span style=font-weight:700>return</span> loan_test_df
loans_with_predictions_df <span style=font-weight:700>=</span> prepare_test_with_predictions(data, test_x<span style=font-weight:700>.</span>index, predicted_probabilities)
loans_with_predictions_df<span style=font-weight:700>.</span>head()
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>       NewCreditCustomer  Amount  Interest  LoanDuration  Education  \
30299              False   530.0     10.68            36        4.0
34126              False   530.0     21.57            24        4.0
11200              False  2300.0     15.62            36        4.0
25133               True   530.0     27.36            36        4.0
42758               True  4250.0     18.94            60        4.0

       NrOfDependants  EmploymentDurationCurrentEmployer  \
30299             NaN                                5.0
34126             NaN                                1.0
11200             0.0                                6.0
25133             NaN                                6.0
42758             NaN                                1.0

       IncomeFromPrincipalEmployer  IncomeFromPension  \
30299                          0.0                0.0
34126                          0.0                0.0
11200                       1159.0                0.0
25133                          0.0                0.0
42758                          0.0                0.0

       IncomeFromFamilyAllowance  ...  Other  Owner  Owner_with_encumbrance  \
30299                        0.0  ...      0      0                       0
34126                        0.0  ...      0      0                       0
11200                        0.0  ...      0      1                       0
25133                        0.0  ...      0      0                       1
42758                        0.0  ...      0      0                       0

       Tenant  Entrepreneur  Fully  Partially  Retiree  Self_employed  \
30299       1             0      0          0        0              0
34126       0             0      0          0        0              0
11200       0             0      1          0        0              0
25133       0             0      0          0        0              0
42758       0             0      0          0        0              0

       predicted_probabilities
30299                 0.662289
34126                 0.749224
11200                 0.775058
25133                 0.423509
42758                 0.535847

[5 rows x 41 columns]
</code></pre></div><h2 id=visualisation>Visualisation</h2>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>import</span> <span style=color:#555>seaborn</span> <span style=font-weight:700>as</span> <span style=color:#555>sns</span>

sns<span style=font-weight:700>.</span>histplot(loans_with_predictions_df[<span style=color:#b84>&#39;predicted_probabilities&#39;</span>], stat<span style=font-weight:700>=</span><span style=color:#b84>&#39;density&#39;</span>)
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>&lt;AxesSubplot:xlabel=&#39;predicted_probabilities&#39;, ylabel=&#39;Density&#39;&gt;
</code></pre></div><figure><img src=/ox-hugo/f31f63f1b05ba3cdf0550c31d919af51046c9403.png>
</figure>
<h2 id=roc-and-auc>ROC and AUC</h2>
<p>Based on actuals and predicted values, it calculates their false positive rate (fpr), the true positive rate (tpr). It also returns the corresponding thresholds used as well as the value for the area under the curve.</p>
<p>actuals, series of actual values indicating whether the loan defaulted or not
predicted_probabilities, series of predicted probabilities of the loan defaulting
Return a unique series of false and true positive rates with corresponding series of thresholds and value for total area under the curve.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=font-weight:700>from</span> <span style=color:#555>sklearn.metrics</span> <span style=font-weight:700>import</span> roc_curve, auc

<span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>get_roc_auc_data</span>(actuals: pd<span style=font-weight:700>.</span>Series, predicted_probabilities: pd<span style=font-weight:700>.</span>Series) <span style=font-weight:700>-&gt;</span> \
        Tuple[np<span style=font-weight:700>.</span>array, np<span style=font-weight:700>.</span>array, np<span style=font-weight:700>.</span>array, <span style=color:#999>float</span>]:
    fpr, tpr, thresholds <span style=font-weight:700>=</span> roc_curve(actuals, predicted_probabilities, pos_label<span style=font-weight:700>=</span><span style=color:#099>1</span>)
    auc_score <span style=font-weight:700>=</span> auc(fpr, tpr)
    <span style=font-weight:700>return</span> fpr, tpr, thresholds, auc_score
fpr, tpr, thresholds, auc_score <span style=font-weight:700>=</span> get_roc_auc_data(loans_with_predictions_df[<span style=color:#b84>&#39;PaidLoan&#39;</span>], loans_with_predictions_df[<span style=color:#b84>&#39;predicted_probabilities&#39;</span>])
sns<span style=font-weight:700>.</span>lineplot(fpr)
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>/Users/rui/.virtualenvs/blog-source/lib/python3.9/site-packages/seaborn/_decorators.py:36: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
/Users/rui/.virtualenvs/blog-source/lib/python3.9/site-packages/numpy/lib/nanfunctions.py:1368: RuntimeWarning: All-NaN slice encountered
&lt;AxesSubplot:&gt;
</code></pre></div><figure><img src=/ox-hugo/5806765bdee88b36445b3ec45bbb7fcc8b002c5b.png>
</figure>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p><a href=https://github.com/dmlc/xgboost>https://github.com/dmlc/xgboost</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p><a href=https://xgboost.readthedocs.io/en/stable/parameter.html#learning-task-parameters>https://xgboost.readthedocs.io/en/stable/parameter.html#learning-task-parameters</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/map/>All pages</a></li>
<li><a href=/search.html>Search</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#installation>Installation</a></li>
<li><a href=#example>Example</a>
<ul>
<li><a href=#hyperparameter-estimation>Hyperparameter estimation</a></li>
</ul>
</li>
<li><a href=#visualisation>Visualisation</a></li>
<li><a href=#roc-and-auc>ROC and AUC</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fruivieira.dev%2fxgboost.html" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&text=XGBoost" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&title=XGBoost" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&is_video=false&description=XGBoost" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=XGBoost&body=Check out this article: https%3a%2f%2fruivieira.dev%2fxgboost.html" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&title=XGBoost" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&title=XGBoost" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fruivieira.dev%2fxgboost.html&name=XGBoost&description=Introduction%20XGBoost1%20is%20a%20popular%20regularizing%20gradient%20boosting%20framework.%0aInstallation%20In%20most%20systems%2c%20installing%20XGBoost%20can%20be%20done%20simply%20by%20using%20pip%0a%24%20pip%20install%20xgboost%20Example%20Training%20XGBoost%20with%20the%20credit-bias%20dataset.%0aimport%20pandas%20as%20pd%20data%20%3d%20pd.read_csv%28%26%2334%3bdata%2fcredit-bias-train.zip%26%2334%3b%29%20data.head%28%29%20NewCreditCustomer%20Amount%20Interest%20LoanDuration%20Education%20%5c%200%20False%202125.0%2020.97%2060%204.0%201%20False%203000.0%2017.12%2060%205.0%202%20True%209100.0%2013.67%2060%204.0%203%20True%20635.0%2042.66%2060%202." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fruivieira.dev%2fxgboost.html&t=XGBoost" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2022 Rui Vieira
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/map/>All pages</a></li>
<li><a href=/search.html>Search</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/css/fa.min.css>
<script src=/js/jquery-3.6.0.min.js></script>
<script src=/js/mark.min.js></script>
<script src=/js/main.js></script>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}}</script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
</html>